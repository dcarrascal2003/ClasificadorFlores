<body>
  <h1>Clasificador de Flores üå∏</h1>
  <video id="video" width="224" height="224" autoplay playsinline></video>
  <br>
  <button onclick="predecir()">Predecir</button>
  <div id="resultado">Esperando modelo...</div>

  <!-- üëá El script va aqu√≠, al final -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
  <script>
    let modelo;
    const video = document.getElementById('video');
    const resultado = document.getElementById('resultado');

    async function iniciarCamara() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
        video.srcObject = stream; // aqu√≠ ya existe el elemento
      } catch (err) {
        alert("Error al acceder a la c√°mara: " + err);
      }
    }

    async function cargarModelo() {
      resultado.innerText = "Cargando modelo...";
      try {
        modelo = await tf.loadLayersModel("carpeta_salida/model.json");
        resultado.innerText = "Modelo cargado ‚úÖ";
      } catch (e) {
        resultado.innerText = "‚ùå Error al cargar el modelo";
        console.error(e);
      }
    }

    async function predecir() {
      if (!modelo) {
        alert("Primero debes cargar el modelo.");
        return;
      }

      const img = tf.browser.fromPixels(video)
        .resizeNearestNeighbor([128, 128])
        .toFloat()
        .div(255)
        .expandDims();

      const pred = modelo.predict(img);
      const clase = pred.argMax(-1).dataSync()[0];

      const nombres = ["clavel", "rosa", "girasol", "diente de le√≥n", "margarita"];
      resultado.innerText = `üåº Predicci√≥n: ${nombres[clase] || "desconocida"} (clase ${clase})`;
    }

    iniciarCamara();
    cargarModelo();
  </script>
</body>

